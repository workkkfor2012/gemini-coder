/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={125:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.image_url_to_base64=void 0,r.image_url_to_base64=async e=>{try{const r=await fetch(e),t=await r.blob();return new Promise(((e,r)=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=()=>r(new Error("Failed to convert image to base64")),n.readAsDataURL(t)}))}catch(e){return console.error("Error fetching image as base64:",e),null}}},474:(e,r,t)=>{e.exports=function e(r,t,n){function o(a,i){if(!t[a]){if(!r[a]){if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[a]={exports:{}};r[a][0].call(l.exports,(function(e){return o(r[a][1][e]||e)}),l,l.exports,e,r,t,n)}return t[a].exports}for(var s=void 0,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,r,n){(function(e){"use strict";var t,n,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var s=0,a=new o(u),i=e.document.createTextNode("");a.observe(i,{characterData:!0}),t=function(){i.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var r=e.document.createElement("script");r.onreadystatechange=function(){u(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},e.document.documentElement.appendChild(r)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,t=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,r;n=!0;for(var t=l.length;t;){for(r=l,l=[],e=-1;++e<t;)r[e]();t=l.length}n=!1}r.exports=function(e){1!==l.push(e)||n||t()}}).call(this,void 0!==t.g?t.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,r,t){"use strict";var n=e(1);function o(){}var s={},a=["REJECTED"],i=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&d(this,e)}function u(e,r,t){this.promise=e,"function"==typeof r&&(this.onFulfilled=r,this.callFulfilled=this.otherCallFulfilled),"function"==typeof t&&(this.onRejected=t,this.callRejected=this.otherCallRejected)}function f(e,r,t){n((function(){var n;try{n=r(t)}catch(r){return s.reject(e,r)}n===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,n)}))}function g(e){var r=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof r)return function(){r.apply(e,arguments)}}function d(e,r){var t=!1;function n(r){t||(t=!0,s.reject(e,r))}function o(r){t||(t=!0,s.resolve(e,r))}var a=m((function(){r(o,n)}));"error"===a.status&&n(a.value)}function m(e,r){var t={};try{t.value=e(r),t.status="success"}catch(e){t.status="error",t.value=e}return t}r.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,r){if("function"!=typeof e&&this.state===i||"function"!=typeof r&&this.state===a)return this;var t=new this.constructor(o);return this.state!==c?f(t,this.state===i?e:r,this.outcome):this.queue.push(new u(t,e,r)),t},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},s.resolve=function(e,r){var t=m(g,r);if("error"===t.status)return s.reject(e,t.value);var n=t.value;if(n)d(e,n);else{e.state=i,e.outcome=r;for(var o=-1,a=e.queue.length;++o<a;)e.queue[o].callFulfilled(r)}return e},s.reject=function(e,r){e.state=a,e.outcome=r;for(var t=-1,n=e.queue.length;++t<n;)e.queue[t].callRejected(r);return e},l.resolve=function(e){return e instanceof this?e:s.resolve(new this(o),e)},l.reject=function(e){var r=new this(o);return s.reject(r,e)},l.all=function(e){var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var a=new Array(t),i=0,c=-1,l=new this(o);++c<t;)u(e[c],c);return l;function u(e,o){r.resolve(e).then((function(e){a[o]=e,++i!==t||n||(n=!0,s.resolve(l,a))}),(function(e){n||(n=!0,s.reject(l,e))}))}},l.race=function(e){var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t,n=e.length,a=!1;if(!n)return this.resolve([]);for(var i=-1,c=new this(o);++i<n;)t=e[i],r.resolve(t).then((function(e){a||(a=!0,s.resolve(c,e))}),(function(e){a||(a=!0,s.reject(c,e))}));return c}},{1:1}],3:[function(e,r,n){(function(r){"use strict";"function"!=typeof r.Promise&&(r.Promise=e(2))}).call(this,void 0!==t.g?t.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,r,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function s(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(o){if("TypeError"!==o.name)throw o;for(var t=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)t.append(e[n]);return t.getBlob(r.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function i(e,r){r&&e.then((function(e){r(null,e)}),(function(e){r(e)}))}function c(e,r,t){"function"==typeof r&&e.then(r),"function"==typeof t&&e.catch(t)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",g=void 0,d={},m=Object.prototype.toString,h="readonly",v="readwrite";function p(e){for(var r=e.length,t=new ArrayBuffer(r),n=new Uint8Array(t),o=0;o<r;o++)n[o]=e.charCodeAt(o);return t}function A(e){return"boolean"==typeof g?a.resolve(g):function(e){return new a((function(r){var t=e.transaction(f,v),n=s([""]);t.objectStore(f).put(n,"key"),t.onabort=function(e){e.preventDefault(),e.stopPropagation(),r(!1)},t.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);r(t||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return g=e}))}function b(e){var r=d[e.name],t={};t.promise=new a((function(e,r){t.resolve=e,t.reject=r})),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then((function(){return t.promise})):r.dbReady=t.promise}function y(e){var r=d[e.name].deferredOperations.pop();if(r)return r.resolve(),r.promise}function _(e,r){var t=d[e.name].deferredOperations.pop();if(t)return t.reject(r),t.promise}function x(e,r){return new a((function(t,n){if(d[e.name]=d[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!r)return t(e.db);b(e),e.db.close()}var s=[e.name];r&&s.push(e.version);var a=o.open.apply(o,s);r&&(a.onupgradeneeded=function(r){var t=a.result;try{t.createObjectStore(e.storeName),r.oldVersion<=1&&t.createObjectStore(f)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+e.name+'" has been upgraded from version '+r.oldVersion+" to version "+r.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){var r=a.result;r.onversionchange=function(e){e.target.close()},t(r),y(e)}}))}function w(e){return x(e,!1)}function E(e){return x(e,!0)}function I(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,o=e.version>e.db.version;if(n&&(e.version!==r&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||t){if(t){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function S(e){return s([p(atob(e.data))],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function C(e){var r=this,t=r._initReady().then((function(){var e=d[r._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(t,e,e),t}function T(e,r,t,n){void 0===n&&(n=1);try{var o=e.db.transaction(e.storeName,r);t(null,o)}catch(o){if(n>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),E(e)})).then((function(){return function(e){b(e);for(var r=d[e.name],t=r.forages,n=0;n<t.length;n++){var o=t[n];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,w(e).then((function(r){return e.db=r,I(e)?E(e):r})).then((function(n){e.db=r.db=n;for(var o=0;o<t.length;o++)t[o]._dbInfo.db=n})).catch((function(r){throw _(e,r),r}))}(e).then((function(){T(e,r,t,n-1)}))})).catch(t);t(o)}}var k={_driver:"asyncStorage",_initStorage:function(e){var r=this,t={db:null};if(e)for(var n in e)t[n]=e[n];var o=d[t.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},d[t.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=C);var s=[];function i(){return a.resolve()}for(var c=0;c<o.forages.length;c++){var l=o.forages[c];l!==r&&s.push(l._initReady().catch(i))}var u=o.forages.slice(0);return a.all(s).then((function(){return t.db=o.db,w(t)})).then((function(e){return t.db=e,I(t,r._defaultConfig.version)?E(t):e})).then((function(e){t.db=o.db=e,r._dbInfo=t;for(var n=0;n<u.length;n++){var s=u[n];s!==r&&(s._dbInfo.db=t.db,s._dbInfo.version=t.version)}}))},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||r)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,r){var t=this,n=new a((function(r,n){t.ready().then((function(){T(t._dbInfo,h,(function(o,s){if(o)return n(o);try{var a=s.objectStore(t._dbInfo.storeName).openCursor(),i=1;a.onsuccess=function(){var t=a.result;if(t){var n=t.value;N(n)&&(n=S(n));var o=e(n,t.key,i++);void 0!==o?r(o):t.continue()}else r()},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return i(n,r),n},getItem:function(e,r){var t=this;e=l(e);var n=new a((function(r,n){t.ready().then((function(){T(t._dbInfo,h,(function(o,s){if(o)return n(o);try{var a=s.objectStore(t._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),N(e)&&(e=S(e)),r(e)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return i(n,r),n},setItem:function(e,r,t){var n=this;e=l(e);var o=new a((function(t,o){var s;n.ready().then((function(){return s=n._dbInfo,"[object Blob]"===m.call(r)?A(s.db).then((function(e){return e?r:(t=r,new a((function(e,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:t.type})},n.readAsBinaryString(t)})));var t})):r})).then((function(r){T(n._dbInfo,v,(function(s,a){if(s)return o(s);try{var i=a.objectStore(n._dbInfo.storeName);null===r&&(r=void 0);var c=i.put(r,e);a.oncomplete=function(){void 0===r&&(r=null),t(r)},a.onabort=a.onerror=function(){var e=c.error?c.error:c.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return i(o,t),o},removeItem:function(e,r){var t=this;e=l(e);var n=new a((function(r,n){t.ready().then((function(){T(t._dbInfo,v,(function(o,s){if(o)return n(o);try{var a=s.objectStore(t._dbInfo.storeName).delete(e);s.oncomplete=function(){r()},s.onerror=function(){n(a.error)},s.onabort=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return i(n,r),n},clear:function(e){var r=this,t=new a((function(e,t){r.ready().then((function(){T(r._dbInfo,v,(function(n,o){if(n)return t(n);try{var s=o.objectStore(r._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=s.error?s.error:s.transaction.error;t(e)}}catch(e){t(e)}}))})).catch(t)}));return i(t,e),t},length:function(e){var r=this,t=new a((function(e,t){r.ready().then((function(){T(r._dbInfo,h,(function(n,o){if(n)return t(n);try{var s=o.objectStore(r._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){t(s.error)}}catch(e){t(e)}}))})).catch(t)}));return i(t,e),t},key:function(e,r){var t=this,n=new a((function(r,n){e<0?r(null):t.ready().then((function(){T(t._dbInfo,h,(function(o,s){if(o)return n(o);try{var a=s.objectStore(t._dbInfo.storeName),i=!1,c=a.openKeyCursor();c.onsuccess=function(){var t=c.result;t?0===e||i?r(t.key):(i=!0,t.advance(e)):r(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}}))})).catch(n)}));return i(n,r),n},keys:function(e){var r=this,t=new a((function(e,t){r.ready().then((function(){T(r._dbInfo,h,(function(n,o){if(n)return t(n);try{var s=o.objectStore(r._dbInfo.storeName).openKeyCursor(),a=[];s.onsuccess=function(){var r=s.result;r?(a.push(r.key),r.continue()):e(a)},s.onerror=function(){t(s.error)}}catch(e){t(e)}}))})).catch(t)}));return i(t,e),t},dropInstance:function(e,r){r=u.apply(this,arguments);var t,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){var s=e.name===n.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):w(e).then((function(r){var t=d[e.name],n=t.forages;t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r;return r}));t=e.storeName?s.then((function(r){if(r.objectStoreNames.contains(e.storeName)){var t=r.version+1;b(e);var n=d[e.name],s=n.forages;r.close();for(var i=0;i<s.length;i++){var c=s[i];c._dbInfo.db=null,c._dbInfo.version=t}var l=new a((function(r,n){var s=o.open(e.name,t);s.onerror=function(e){s.result.close(),n(e)},s.onupgradeneeded=function(){s.result.deleteObjectStore(e.storeName)},s.onsuccess=function(){var e=s.result;e.close(),r(e)}}));return l.then((function(e){n.db=e;for(var r=0;r<s.length;r++){var t=s[r];t._dbInfo.db=e,y(t._dbInfo)}})).catch((function(r){throw(_(e,r)||a.resolve()).catch((function(){})),r}))}})):s.then((function(r){b(e);var t=d[e.name],n=t.forages;r.close();for(var s=0;s<n.length;s++)n[s]._dbInfo.db=null;var i=new a((function(r,t){var n=o.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),t(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),r(e)}}));return i.then((function(e){t.db=e;for(var r=0;r<n.length;r++)y(n[r]._dbInfo)})).catch((function(r){throw(_(e,r)||a.resolve()).catch((function(){})),r}))}))}else t=a.reject("Invalid arguments");return i(t,r),t}};var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=/^~~local_forage_type~([^~]+)~/,B="__lfsc__:",j="arbf",D="blob",P="si08",L="ui08",M="uic8",F="si16",$="si32",U="ur16",z="ui32",W="fl32",q="fl64",G=Object.prototype.toString;function K(e){var r,t,n,o,s,a=.75*e.length,i=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var l=new ArrayBuffer(a),u=new Uint8Array(l);for(r=0;r<i;r+=4)t=R.indexOf(e[r]),n=R.indexOf(e[r+1]),o=R.indexOf(e[r+2]),s=R.indexOf(e[r+3]),u[c++]=t<<2|n>>4,u[c++]=(15&n)<<4|o>>2,u[c++]=(3&o)<<6|63&s;return l}function V(e){var r,t=new Uint8Array(e),n="";for(r=0;r<t.length;r+=3)n+=R[t[r]>>2],n+=R[(3&t[r])<<4|t[r+1]>>4],n+=R[(15&t[r+1])<<2|t[r+2]>>6],n+=R[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var Y={serialize:function(e,r){var t="";if(e&&(t=G.call(e)),e&&("[object ArrayBuffer]"===t||e.buffer&&"[object ArrayBuffer]"===G.call(e.buffer))){var n,o=B;e instanceof ArrayBuffer?(n=e,o+=j):(n=e.buffer,"[object Int8Array]"===t?o+=P:"[object Uint8Array]"===t?o+=L:"[object Uint8ClampedArray]"===t?o+=M:"[object Int16Array]"===t?o+=F:"[object Uint16Array]"===t?o+=U:"[object Int32Array]"===t?o+=$:"[object Uint32Array]"===t?o+=z:"[object Float32Array]"===t?o+=W:"[object Float64Array]"===t?o+=q:r(new Error("Failed to get type for BinaryArray"))),r(o+V(n))}else if("[object Blob]"===t){var s=new FileReader;s.onload=function(){var t="~~local_forage_type~"+e.type+"~"+V(this.result);r(B+D+t)},s.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),r(null,t)}},deserialize:function(e){if(e.substring(0,9)!==B)return JSON.parse(e);var r,t=e.substring(13),n=e.substring(9,13);if(n===D&&O.test(t)){var o=t.match(O);r=o[1],t=t.substring(o[0].length)}var a=K(t);switch(n){case j:return a;case D:return s([a],{type:r});case P:return new Int8Array(a);case L:return new Uint8Array(a);case M:return new Uint8ClampedArray(a);case F:return new Int16Array(a);case U:return new Uint16Array(a);case $:return new Int32Array(a);case z:return new Uint32Array(a);case W:return new Float32Array(a);case q:return new Float64Array(a);default:throw new Error("Unkown type: "+n)}},stringToBuffer:K,bufferToString:V};function H(e,r,t,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,n)}function J(e,r,t,n,o,s){e.executeSql(t,n,o,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],(function(e,i){i.rows.length?s(e,a):H(e,r,(function(){e.executeSql(t,n,o,s)}),s)}),s):s(e,a)}),s)}function X(e,r,t,n){var o=this;e=l(e);var s=new a((function(s,a){o.ready().then((function(){void 0===r&&(r=null);var i=r,c=o._dbInfo;c.serializer.serialize(r,(function(r,l){l?a(l):c.db.transaction((function(t){J(t,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,r],(function(){s(i)}),(function(e,r){a(r)}))}),(function(r){if(r.code===r.QUOTA_ERR){if(n>0)return void s(X.apply(o,[e,i,t,n-1]));a(r)}}))}))})).catch(a)}));return i(s,t),s}var Q={_driver:"webSQLStorage",_initStorage:function(e){var r=this,t={db:null};if(e)for(var n in e)t[n]="string"!=typeof e[n]?e[n].toString():e[n];var o=new a((function(e,n){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(e){return n(e)}t.db.transaction((function(o){H(o,t,(function(){r._dbInfo=t,e()}),(function(e,r){n(r)}))}),n)}));return t.serializer=Y,o},_support:"function"==typeof openDatabase,iterate:function(e,r){var t=this,n=new a((function(r,n){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){J(t,o,"SELECT * FROM "+o.storeName,[],(function(t,n){for(var s=n.rows,a=s.length,i=0;i<a;i++){var c=s.item(i),l=c.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,c.key,i+1)))return void r(l)}r()}),(function(e,r){n(r)}))}))})).catch(n)}));return i(n,r),n},getItem:function(e,r){var t=this;e=l(e);var n=new a((function(r,n){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){J(t,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,t){var n=t.rows.length?t.rows.item(0).value:null;n&&(n=o.serializer.deserialize(n)),r(n)}),(function(e,r){n(r)}))}))})).catch(n)}));return i(n,r),n},setItem:function(e,r,t){return X.apply(this,[e,r,t,1])},removeItem:function(e,r){var t=this;e=l(e);var n=new a((function(r,n){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){J(t,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){r()}),(function(e,r){n(r)}))}))})).catch(n)}));return i(n,r),n},clear:function(e){var r=this,t=new a((function(e,t){r.ready().then((function(){var n=r._dbInfo;n.db.transaction((function(r){J(r,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,r){t(r)}))}))})).catch(t)}));return i(t,e),t},length:function(e){var r=this,t=new a((function(e,t){r.ready().then((function(){var n=r._dbInfo;n.db.transaction((function(r){J(r,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(r,t){var n=t.rows.item(0).c;e(n)}),(function(e,r){t(r)}))}))})).catch(t)}));return i(t,e),t},key:function(e,r){var t=this,n=new a((function(r,n){t.ready().then((function(){var o=t._dbInfo;o.db.transaction((function(t){J(t,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,t){var n=t.rows.length?t.rows.item(0).key:null;r(n)}),(function(e,r){n(r)}))}))})).catch(n)}));return i(n,r),n},keys:function(e){var r=this,t=new a((function(e,t){r.ready().then((function(){var n=r._dbInfo;n.db.transaction((function(r){J(r,n,"SELECT key FROM "+n.storeName,[],(function(r,t){for(var n=[],o=0;o<t.rows.length;o++)n.push(t.rows.item(o).key);e(n)}),(function(e,r){t(r)}))}))})).catch(t)}));return i(t,e),t},dropInstance:function(e,r){r=u.apply(this,arguments);var t=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var n,o=this;return i(n=e.name?new a((function(r){var n;n=e.name===t.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?r({db:n,storeNames:[e.storeName]}):r(function(e){return new a((function(r,t){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var o=[],s=0;s<n.rows.length;s++)o.push(n.rows.item(s).name);r({db:e,storeNames:o})}),(function(e,r){t(r)}))}),(function(e){t(e)}))}))}(n))})).then((function(e){return new a((function(r,t){e.db.transaction((function(n){function o(e){return new a((function(r,t){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){r()}),(function(e,r){t(r)}))}))}for(var s=[],i=0,c=e.storeNames.length;i<c;i++)s.push(o(e.storeNames[i]));a.all(s).then((function(){r()})).catch((function(e){t(e)}))}),(function(e){t(e)}))}))})):a.reject("Invalid arguments"),r),n}};function Z(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function ee(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var re={_driver:"localStorageWrapper",_initStorage:function(e){var r={};if(e)for(var t in e)r[t]=e[t];return r.keyPrefix=Z(e,this._defaultConfig),ee()?(this._dbInfo=r,r.serializer=Y,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,r){var t=this,n=t.ready().then((function(){for(var r=t._dbInfo,n=r.keyPrefix,o=n.length,s=localStorage.length,a=1,i=0;i<s;i++){var c=localStorage.key(i);if(0===c.indexOf(n)){var l=localStorage.getItem(c);if(l&&(l=r.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(o),a++)))return l}}}));return i(n,r),n},getItem:function(e,r){var t=this;e=l(e);var n=t.ready().then((function(){var r=t._dbInfo,n=localStorage.getItem(r.keyPrefix+e);return n&&(n=r.serializer.deserialize(n)),n}));return i(n,r),n},setItem:function(e,r,t){var n=this;e=l(e);var o=n.ready().then((function(){void 0===r&&(r=null);var t=r;return new a((function(o,s){var a=n._dbInfo;a.serializer.serialize(r,(function(r,n){if(n)s(n);else try{localStorage.setItem(a.keyPrefix+e,r),o(t)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return i(o,t),o},removeItem:function(e,r){var t=this;e=l(e);var n=t.ready().then((function(){var r=t._dbInfo;localStorage.removeItem(r.keyPrefix+e)}));return i(n,r),n},clear:function(e){var r=this,t=r.ready().then((function(){for(var e=r._dbInfo.keyPrefix,t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return i(t,e),t},length:function(e){var r=this.keys().then((function(e){return e.length}));return i(r,e),r},key:function(e,r){var t=this,n=t.ready().then((function(){var r,n=t._dbInfo;try{r=localStorage.key(e)}catch(e){r=null}return r&&(r=r.substring(n.keyPrefix.length)),r}));return i(n,r),n},keys:function(e){var r=this,t=r.ready().then((function(){for(var e=r._dbInfo,t=localStorage.length,n=[],o=0;o<t;o++){var s=localStorage.key(o);0===s.indexOf(e.keyPrefix)&&n.push(s.substring(e.keyPrefix.length))}return n}));return i(t,e),t},dropInstance:function(e,r){if(r=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var n,o=this;return n=e.name?new a((function(r){e.storeName?r(Z(e,o._defaultConfig)):r(e.name+"/")})).then((function(e){for(var r=localStorage.length-1;r>=0;r--){var t=localStorage.key(r);0===t.indexOf(e)&&localStorage.removeItem(t)}})):a.reject("Invalid arguments"),i(n,r),n}},te=function(e,r){for(var t=e.length,n=0;n<t;){if((o=e[n])===(s=r)||"number"==typeof o&&"number"==typeof s&&isNaN(o)&&isNaN(s))return!0;n++}var o,s;return!1},ne=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},oe={},se={},ae={INDEXEDDB:k,WEBSQL:Q,LOCALSTORAGE:re},ie=[ae.INDEXEDDB._driver,ae.WEBSQL._driver,ae.LOCALSTORAGE._driver],ce=["dropInstance"],le=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ce),ue={description:"",driver:ie.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function fe(e,r){e[r]=function(){var t=arguments;return e.ready().then((function(){return e[r].apply(e,t)}))}}function ge(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(ne(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var de=function(){function e(r){for(var t in function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),ae)if(ae.hasOwnProperty(t)){var n=ae[t],o=n._driver;this[t]=o,oe[o]||this.defineDriver(n)}this._defaultConfig=ge({},ue),this._config=ge({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var r in e){if("storeName"===r&&(e[r]=e[r].replace(/\W/g,"_")),"version"===r&&"number"!=typeof e[r])return new Error("Database version must be a number.");this._config[r]=e[r]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,r,t){var n=new a((function(r,t){try{var n=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void t(o);for(var s=le.concat("_initStorage"),c=0,l=s.length;c<l;c++){var u=s[c];if((!te(ce,u)||e[u])&&"function"!=typeof e[u])return void t(o)}!function(){for(var r=function(e){return function(){var r=new Error("Method "+e+" is not implemented by the current driver"),t=a.reject(r);return i(t,arguments[arguments.length-1]),t}},t=0,n=ce.length;t<n;t++){var o=ce[t];e[o]||(e[o]=r(o))}}();var f=function(t){oe[n]&&console.info("Redefining LocalForage driver: "+n),oe[n]=e,se[n]=t,r()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(f,t):f(!!e._support):f(!0)}catch(e){t(e)}}));return c(n,r,t),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,r,t){var n=oe[e]?a.resolve(oe[e]):a.reject(new Error("Driver not found."));return c(n,r,t),n},e.prototype.getSerializer=function(e){var r=a.resolve(Y);return c(r,e),r},e.prototype.ready=function(e){var r=this,t=r._driverSet.then((function(){return null===r._ready&&(r._ready=r._initDriver()),r._ready}));return c(t,e,e),t},e.prototype.setDriver=function(e,r,t){var n=this;ne(e)||(e=[e]);var o=this._getSupportedDrivers(e);function s(){n._config.driver=n.driver()}function i(e){return n._extend(e),s(),n._ready=n._initStorage(n._config),n._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve();return this._driverSet=l.then((function(){var e=o[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,s(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var r=0;return function t(){for(;r<e.length;){var o=e[r];return r++,n._dbInfo=null,n._ready=null,n.getDriver(o).then(i).catch(t)}s();var c=new Error("No available storage method found.");return n._driverSet=a.reject(c),n._driverSet}()}}(o)}))})).catch((function(){s();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet})),c(this._driverSet,r,t),this._driverSet},e.prototype.supports=function(e){return!!se[e]},e.prototype._extend=function(e){ge(this,e)},e.prototype._getSupportedDrivers=function(e){for(var r=[],t=0,n=e.length;t<n;t++){var o=e[t];this.supports(o)&&r.push(o)}return r},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,r=le.length;e<r;e++)fe(this,le[e])},e.prototype.createInstance=function(r){return new e(r)},e}(),me=new de;r.exports=me},{3:3}]},{},[4])(4)},588:function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.setup_keep_alive=function(){if(!o.default.browserAction){const e=async()=>{try{chrome.alarms.create("keep-alive",{when:Date.now()+3e4})}catch(e){console.error("Error creating KeepAlive alarm:",e)}};chrome.runtime.onStartup.addListener(e),chrome.runtime.onInstalled.addListener(e),chrome.alarms.onAlarm.addListener((()=>{e()}))}};const o=n(t(3346))},999:function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.setup_message_listeners=r.handle_messages=void 0;const o=n(t(3346)),s=t(4366),a=t(4482),i=t(125),c=[];let l=!1;const u=new Map;r.handle_messages=e=>{console.log("ðŸŽ¬ [Browser Extension] ENTERED handle_messages function:",{action:e.action,messageType:typeof e,hasAction:"action"in e,timestamp:(new Date).toISOString()});try{console.log("ðŸ” [Browser Extension] Full message object:",e),"initialize-chats"==e.action?(console.log("ðŸ“‹ [Browser Extension] Routing to handle_initialize_chats_message"),g(e)):"initialize-chat"==e.action?(console.log("ðŸ’¬ [Browser Extension] Routing to handle_initialize_chat_message"),d(e)):"start-session"==e.action?(console.log("ðŸš€ [Browser Extension] ROUTING TO handle_start_session_message"),console.log("ðŸ” [Browser Extension] start-session message details:",{sessionId:e.sessionId,initialPrompt:e.initialPrompt?.substring(0,100)+"...",chatConfigUrl:e.chatConfig?.url,clientId:e.client_id}),m(e),console.log("âœ… [Browser Extension] RETURNED FROM handle_start_session_message")):"send-to-session"==e.action?(console.log("ðŸ“¤ [Browser Extension] Routing to handle_send_to_session_message"),h(e)):console.warn(`â“ [Browser Extension] Unknown action received: ${e.action}`),console.log(`âœ… [Browser Extension] handle_messages completed successfully for action: ${e.action}`)}catch(r){console.error("ðŸ’¥ [Browser Extension] CRITICAL ERROR in handle_messages:"),r instanceof Error?(console.error(`   Error name: ${r.name}`),console.error(`   Error message: ${r.message}`),console.error("   Stack trace:",r.stack)):console.error("   Non-Error object:",r),console.error("   Message that caused error:",e)}};const f=async()=>{if(0==c.length||!l)return void(l=!1);const e=c[0];if(e.timeout_id&&(clearTimeout(e.timeout_id),e.timeout_id=void 0),e.current_index>=e.message.chats.length)return c.shift(),void(c.length>0?(c[0].current_index=0,await f()):l=!1);const r=e.message.chats[e.current_index],t=await(async(e,r=3)=>{let t=0;for(;t<1e3;){let n="";for(let e=0;e<r;e++)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));const s=`${e}:${n}`;if(!(await o.default.storage.local.get(s))[s])return n;t++}throw new Error("Unable to generate a unique ID after maximum attempts")})("chat-init");if(await o.default.storage.local.set({[`chat-init:${t}`]:{text:e.message.text,current_chat:r,client_id:e.message.client_id}}),"https://openrouter.ai/chat"==r.url){const e=new URLSearchParams;r.model&&e.set("models",r.model);const n=`${r.url}?${e.toString()}#gemini-coder-${t}`;o.default.tabs.create({url:n,active:!0})}else o.default.tabs.create({url:`${r.url}#gemini-coder-${t}`,active:!0});e.current_index++,e.timeout_id=setTimeout((()=>{console.warn(`Chat initialization timeout for ${r.url}. Moving to next chat.`),e.remaining_chats--,f()}),5e3)},g=async e=>{e.chats&&e.chats.length>0&&(c.push({message:e,remaining_chats:e.chats.length,current_index:0}),await(async()=>{!l&&c.length>0&&(l=!0,await f())})())},d=async e=>{const r={url:e.url,model:e.model,temperature:e.temperature,top_p:e.top_p,system_instructions:e.system_instructions,options:e.options},t={action:"initialize-chats",text:e.text,chats:[r],client_id:e.client_id};g(t)};r.setup_message_listeners=()=>{o.default.runtime.onMessage.addListener(((e,r,t)=>{if((0,a.is_message)(e))if("update-saved-websites"==e.action&&e.websites)(0,s.send_saved_websites)(e.websites);else if("chat-initialized"==e.action)(async()=>{c.length>0&&(c[0].timeout_id&&(clearTimeout(c[0].timeout_id),c[0].timeout_id=void 0),c[0].remaining_chats--,await f())})();else if("apply-chat-response"==e.action)(0,s.send_message_to_server)({action:"apply-chat-response",client_id:e.client_id});else if("get-tab-data"==e.action)return(async e=>{try{const r=await o.default.tabs.query({active:!0,currentWindow:!0}),t=r[0]?.url,n=r[0]?.favIconUrl;if(!t||!t.startsWith("http"))throw new Error("URL is not valid");let s="";const a=await fetch(t);if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);let c;if(s=await a.text(),n)try{c=await(0,i.image_url_to_base64)(n)||void 0}catch(e){console.error("Error converting favicon to base64:",e)}e({html:s,favicon_base64:c})}catch(r){console.error("Error getting tab data:",r),e()}})((e=>{t(e)})),!0;return!1}))};const m=async e=>{console.log("ðŸŽ¯ [Browser Extension] ENTERED handle_start_session_message function"),console.log("ðŸ” [Browser Extension] Message validation:",{hasSessionId:!!e.sessionId,hasChatConfig:!!e.chatConfig,hasUrl:!!e.chatConfig?.url,hasInitialPrompt:!!e.initialPrompt,sessionId:e.sessionId,url:e.chatConfig?.url,client_id:e.client_id,promptLength:e.initialPrompt?.length||0});try{if(!e.chatConfig||!e.chatConfig.url)return void console.error("âŒ [Browser Extension] Invalid message: missing chatConfig or URL");const r=`${e.chatConfig.url}#cwc-session-${e.sessionId}`;console.log(`ðŸŒ [Browser Extension] Preparing to create tab with URL: ${r}`),console.log("ðŸš€ [Browser Extension] Calling browser.tabs.create...");try{const t=await o.default.tabs.create({url:r,active:!0});if(!t)return void console.error("ðŸ’£ [Browser Extension] Tab creation returned null/undefined");if(console.log("ðŸ“‘ [Browser Extension] Tab created successfully:",{tabId:t.id,url:t.url,sessionId:e.sessionId,status:t.status}),t.id){u.set(e.sessionId,t.id),console.log(`ðŸ—‚ï¸ [Browser Extension] Session mapping stored: ${e.sessionId} -> ${t.id}`);const r=(n,s)=>{if(n===t.id&&"complete"===s.status){console.log(`âœ… [Browser Extension] Tab ${n} loading complete, preparing initialization message`),o.default.tabs.onUpdated.removeListener(r);const s={action:"initialize-session",sessionId:e.sessionId,initialPrompt:e.initialPrompt,chatConfig:e.chatConfig,client_id:e.client_id};console.log(`ðŸ“¨ [Browser Extension] Sending initialization message to tab ${t.id}:`,s),o.default.tabs.sendMessage(t.id,s).then((()=>{console.log(`âœ… [Browser Extension] Initialization message sent successfully to tab ${t.id}`)})).catch((e=>{console.error(`âŒ [Browser Extension] Error sending message to tab ${t.id}:`,e)}))}};o.default.tabs.onUpdated.addListener(r),console.log(`ðŸ‘‚ [Browser Extension] Added tab update listener for tab ${t.id}`)}else console.error("âŒ [Browser Extension] Tab created but tab.id is undefined:",t)}catch(e){console.error("ðŸ’£ [Browser Extension] Error creating tab:",e),console.error("ðŸ’£ [Browser Extension] Target URL was:",r)}console.log("âœ… [Browser Extension] browser.tabs.create call completed (async)")}catch(r){console.error("ðŸ’¥ [Browser Extension] EXCEPTION in handle_start_session_message:"),r instanceof Error?(console.error(`   Error name: ${r.name}`),console.error(`   Error message: ${r.message}`),console.error("   Stack trace:",r.stack)):console.error("   Non-Error object:",r),console.error("   Message that caused error:",e)}console.log("ðŸ [Browser Extension] EXITING handle_start_session_message function")},h=async e=>{try{const r=u.get(e.sessionId);if(r)try{await o.default.tabs.get(r),o.default.tabs.sendMessage(r,{action:"send-message",prompt:e.prompt})}catch(r){u.delete(e.sessionId),console.warn(`Tab for session ${e.sessionId} no longer exists`)}else console.warn(`No tab found for session ${e.sessionId}`)}catch(e){console.error("Failed to send message to session:",e)}}},3295:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SECURITY_TOKENS=r.DEFAULT_PORT=void 0,r.DEFAULT_PORT=55155,r.SECURITY_TOKENS={BROWSERS:"gemini-coder",VSCODE:"gemini-coder-vscode"}},3346:function(e,r){var t,n;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,t=function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const r="The message port closed before a response was received.",t=e=>{const t={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(t).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(e,r=void 0){super(r),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const o=(r,t)=>(...n)=>{e.runtime.lastError?r.reject(new Error(e.runtime.lastError.message)):t.singleCallbackArg||n.length<=1&&!1!==t.singleCallbackArg?r.resolve(n[0]):r.resolve(n)},s=e=>1==e?"argument":"arguments",a=(e,r,t)=>new Proxy(r,{apply:(r,n,o)=>t.call(n,e,...o)});let i=Function.call.bind(Object.prototype.hasOwnProperty);const c=(e,r={},t={})=>{let n=Object.create(null),l={has:(r,t)=>t in e||t in n,get(l,u,f){if(u in n)return n[u];if(!(u in e))return;let g=e[u];if("function"==typeof g)if("function"==typeof r[u])g=a(e,e[u],r[u]);else if(i(t,u)){let r=((e,r)=>function(t,...n){if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${s(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${s(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((s,a)=>{if(r.fallbackToNoCallback)try{t[e](...n,o({resolve:s,reject:a},r))}catch(o){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),t[e](...n),r.fallbackToNoCallback=!1,r.noCallback=!0,s()}else r.noCallback?(t[e](...n),s()):t[e](...n,o({resolve:s,reject:a},r))}))})(u,t[u]);g=a(e,e[u],r)}else g=g.bind(e);else if("object"==typeof g&&null!==g&&(i(r,u)||i(t,u)))g=c(g,r[u],t[u]);else{if(!i(t,"*"))return Object.defineProperty(n,u,{configurable:!0,enumerable:!0,get:()=>e[u],set(r){e[u]=r}}),g;g=c(g,r[u],t["*"])}return n[u]=g,g},set:(r,t,o,s)=>(t in n?n[t]=o:e[t]=o,!0),defineProperty:(e,r,t)=>Reflect.defineProperty(n,r,t),deleteProperty:(e,r)=>Reflect.deleteProperty(n,r)},u=Object.create(e);return new Proxy(u,l)},l=e=>({addListener(r,t,...n){r.addListener(e.get(t),...n)},hasListener:(r,t)=>r.hasListener(e.get(t)),removeListener(r,t){r.removeListener(e.get(t))}}),u=new n((e=>"function"!=typeof e?e:function(r){const t=c(r,{},{getContent:{minArgs:0,maxArgs:0}});e(t)})),f=new n((e=>"function"!=typeof e?e:function(r,t,n){let o,s,a=!1,i=new Promise((e=>{o=function(r){a=!0,e(r)}}));try{s=e(r,t,o)}catch(e){s=Promise.reject(e)}const c=!0!==s&&((l=s)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==s&&!c&&!a)return!1;return(c?s:i).then((e=>{n(e)}),(e=>{let r;r=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:r})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)})),!0})),g=({reject:t,resolve:n},o)=>{e.runtime.lastError?e.runtime.lastError.message===r?n():t(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?t(new Error(o.message)):n(o)},d=(e,r,t,...n)=>{if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${s(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${s(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((e,r)=>{const o=g.bind(null,{resolve:e,reject:r});n.push(o),t.sendMessage(...n)}))},m={devtools:{network:{onRequestFinished:l(u)}},runtime:{onMessage:l(f),onMessageExternal:l(f),sendMessage:d.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:d.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},h={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return t.privacy={network:{"*":h},services:{"*":h},websites:{"*":h}},c(e,m,t)};e.exports=t(chrome)}},void 0===(n=t.apply(r,[e]))||(e.exports=n)},4366:function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.check_server_health=f,r.connect_websocket=async function e(){if(!u&&l?.readyState!==WebSocket.OPEN){u=!0;try{if(!await f())return console.debug("Server health check failed, retrying in 5 seconds..."),void setTimeout((()=>{u=!1,e()}),s.CONFIG.RECONNECT_DELAY);const r=i.default.runtime.getManifest().version;l=new WebSocket(`ws://localhost:${a.DEFAULT_PORT}?token=${a.SECURITY_TOKENS.BROWSERS}&version=${r}`),l.onopen=()=>{console.log("âœ… [Browser Extension] Connected with the VS Code!"),u=!1,async function(){try{const e=c.default.createInstance({name:"gemini-coder-connector",storeName:"websites"}),r=[];await e.iterate((e=>{r.push({url:e.url,title:e.title,content:e.content,favicon:e.favicon})})),r.length>0&&g(r)}catch(e){console.error("Error sending saved websites after connection:",e)}}()},l.onmessage=async e=>{console.log("ðŸ” [Browser Extension] UNFILTERED MESSAGE RECEIVED:",{data:e.data,type:typeof e.data,length:e.data?.length||0,timestamp:(new Date).toISOString()});try{const r=e.data;if(console.log("ðŸ“¥ [Browser Extension] Processing raw message:",r),!r)return void console.warn("âš ï¸ [Browser Extension] Received empty or null message");const t=JSON.parse(r);if(console.log("âœ¨ [Browser Extension] Successfully parsed message:",t),!t.action)return void console.warn("âš ï¸ [Browser Extension] Message missing action property:",t);console.log(`ðŸŽ¯ [Browser Extension] About to handle action: "${t.action}"`),"start-session"===t.action&&console.log("ðŸš€ [Browser Extension] SPECIAL HANDLING for start-session message:",{sessionId:t.sessionId,hasInitialPrompt:!!t.initialPrompt,hasChatConfig:!!t.chatConfig,chatConfigUrl:t.chatConfig?.url}),(0,o.handle_messages)(t),console.log(`âœ… [Browser Extension] Message handled successfully for action: ${t.action}`)}catch(r){console.error("âŒ [Browser Extension] CRITICAL ERROR in message handler:"),r instanceof Error?(console.error(`   Error name: ${r.name}`),console.error(`   Error message: ${r.message}`),console.error("   Stack trace:",r.stack)):console.error("   Non-Error object caught:",r),console.error("   Raw event data that caused error:",e.data),console.error("   Event object:",e)}},l.onclose=r=>{console.log(`ðŸš¶ [Browser Extension] Disconnected from VS Code. Code: ${r.code}, Reason: ${r.reason}`),l=null,u=!1,setTimeout(e,s.CONFIG.RECONNECT_DELAY)},l.onerror=e=>{console.error("ðŸ’¥ [Browser Extension] WebSocket error:",e),u=!1,l=null}}catch(r){u=!1,setTimeout(e,s.CONFIG.RECONNECT_DELAY)}}},r.send_saved_websites=g,r.send_message_to_server=function(e){return l?.readyState==WebSocket.OPEN?(console.debug("Sending message to server:",e),l.send(JSON.stringify(e)),!0):(console.warn("WebSocket not connected, cannot send message:",e),!1)};const o=t(999),s=t(5015),a=t(3295),i=n(t(3346)),c=n(t(474));let l=null,u=!1;async function f(){try{return(await fetch(`http://localhost:${a.DEFAULT_PORT}/health`)).ok}catch{return!1}}function g(e){if(l?.readyState==WebSocket.OPEN){const r={action:"update-saved-websites",websites:e.map((e=>({url:e.url,title:e.title,content:e.content,favicon:e.favicon})))};return console.log(r),l.send(JSON.stringify(r)),!0}return!1}},4482:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.is_message=function(e){return e&&"string"==typeof e.action}},5015:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CONFIG=void 0,r.CONFIG={RECONNECT_DELAY:5e3}},7871:function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.clear_chat_init_data=void 0;const o=n(t(3346));r.clear_chat_init_data=async()=>{try{const e=await o.default.storage.local.get(),r=Object.keys(e).filter((e=>e.startsWith("chat-init:")));r.length>0&&await o.default.storage.local.remove(r)}catch(e){console.error("Error clearing chat init data:",e)}}}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var s=r[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";const e=t(4366),r=t(588),n=t(999),o=t(7871);(async function(){await(0,o.clear_chat_init_data)(),(0,e.connect_websocket)(),(0,r.setup_keep_alive)(),(0,n.setup_message_listeners)()})().catch((e=>{console.error("Error during initialization:",e)}))})()})();